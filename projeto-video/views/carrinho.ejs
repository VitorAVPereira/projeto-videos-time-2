<!--
Projeto Videos Online
Parte do curso Javascript Programmer
Time 02- Carrinho
-->
<!-- ============= HEADER ================ -->
<%- include('header.ejs')%>

<style>
  .img {
    
    border-radius: 4px;
    padding: 5px;
    width: 200px;
    height: 495px;
   
  } 
  .imgMenor {
    
    border-radius: 4px;
    padding: 5px;
    width: 270px;
    height: 400px;
   
  } 
  .body {
    font-weight: bold;
  }
  .p {
    font-size: 50px;
  }
  .alignR{
    text-align: right;
    cursor:pointer;text-decoration:underline
  }
</style>
<!-- ========= FIM HEADER ============= -->
<!-- ======= MENU DO PROJETO ======== -->
<header class="text-center">
  <div class="row">
    <div class="col-sm-4 text-left">
      <img src="../imagens/primeirasessão.png" width="250">
    </div>
    <div class="col-sm-4 mt-5">
      <h2 style="font: size 100%;"><%=info.titulo%></h2>
    </div>
    <div class="col-sm-4 alignR">
      <a id="bemVindo" href="perfilDoUsuario"><%=info.user%></a>
      <% if (info.user) { %>
        <a class="alignR" id="sair" href="index">Sair</a>
        <% } else { %>
      <a id="entrar" class="alignR text-right" href="login">Entrar</a>
          <% } %>
    </div>
  </div>
</header>


<%if(info.user) { %>
  <div class="alignR">
   
  </div>
  <% } else { %>
    <div class="alignR">
      <a id="cadastro" href="cadastro"></a>
    </div>
    <% }  %>
</div>

  <%- include('nav.ejs')%>
<!-- =============== FIM DO MENU =============== -->



<!-- =============== Conteúdo ================== -->

<!--================ Carrinho ===================-->
  <br />
  <div>
  <div class="row">
    <div class="container-sm" class="col-md-8" class="w-50 mx-auto p- mt-3 mb-3 " >
      <section >
       
          <table class="table-bordered table text-white" cellspacing="0" >
                  <h4 class="text-left ">Meu Carrinho</h4>
                  <thead class="text-primary">
                  <tr class="text-uppercase">
                  
                  <th scope="col">Titulo</th>
                  <th scope="col" width="120">Telas</th>
                  <th scope="col" width="120">Ano</th>
                  <th scope="col" width="120">Valor</th>
                  <th scope="col" class="text-center" width="200"></th>
              </tr>
            </thead>
          
               <%
               total=0
               carrinho.forEach((item)=>{
               total += parseFloat(item.valor)
                %>

                <tr>
                <td><%=item.titulo%> </td>
                <td><%=item.qtd%></td>
                  <th><%=item.ano%></th>
                  
                  <td  id="preco" data-valor="<%=item.valor%>"> <%=item.valor%> </td>
                
                  <td>
                    <button class="btn btn-warning bt-carrinho" data-id="<%=item.carrinho_id%>">Excluir</button>
                  </td>
                  </tr>
              <%})%>
    
    </table>
    <button class="btn btn-warning bt-limpa" data-limpa="<%=carrinho%>" > Limpar carrinho </button>
 </div>


<!--================ Fim do Carrinho ===================-->

<!--================= Total, Cupom e Botões =================-->

<div class="col-md-4 text-right mr-5">
        <aside >
          <div class="w-50 mx-auto p-3 mt-3 mb-3" style="border:1px solid #ccc;border-radius: 8px;">
            <table border="1" class="container text-center">
              <tr>
                <h2 class="text-center">Resumo do Pedido</h2>
                <div class="text-center mt-5 font-weight-bold" id="total"> Total: R$<%=total.toFixed(2)%> </div>
              </tr>
            </table>
            <p id="nomeDesconto"></p>
            <p id="total3"></p>
          </div>
          <hr />
          <div class="w-50 mx-auto p-3 mt-3 mb-3" style="border:1px solid #ccc;border-radius: 8px;">

            <!--Setor de Cupom-->
           
            <h3>Insira seu cupom: </h3>
            <input type="number" name="text1">
            <br />
            <div>
              <hr />
              <input class="btn btn-primary" type="button" value="Validar Cupom" name="Submit"
                onclick="validate(document.getElementsByName('text1')[0].value)"></input>
              <hr />
            </div>
            <button class="btn btn-primary">COMPRAR</button>
            <hr />
            <button onclick="window.location.href='/index'" class="btn btn-primary">Adicionar mais
              produtos</button>
          </div>
        </aside>
  </section>

</div> 

<!--================= Total, Cupom e Botões =================-->



<!--========= Imagens Rodape ==========================-->

  <section class="container">
    <div id="galeria2" class="text-center">
      <div class="row" class=" mx-auto mt-3 mb-3 ">
        <div class="col-sm-4"><img src="../imagens/avengers.jpg" class="imgMenor"> </div>
        <div class="col-sm-4"><img src="../imagens/viuvanegra.jpg" class="imgMenor"> </div>
        <div class="col-sm-4"><img src="../imagens/guerracivil.jpeg" class="imgMenor"> </div>
      </div>
    </div>
    </div>
  </section>


<!--========= FIM  Imagens Rodape ==========================-->



<!-- =============== Fim do Conteúdo ================== -->

<script>



//// carrinho - botão de deletar coluna
  $().ready(function(){
      console.log("jquery funfando...")
      $('.bt-carrinho').click(function(){
              let datalim = $(this).attr("data-limpa") 

            $.post('/delete-carrinho',
            { 
              id:datalim,
            },
            function (data,status)
            {
                location.href = "/carrinho" //app.get

            },"json")
          })
  })
  /////// carrinho - botão de deletar FIM

  ////// LIMPAR CARRINHO
  $().ready(function(){
      console.log("jquery funfando...")
      $('.bt-limpa').click(function(){ 
              let dataid = $(this).attr("data-id") 

            $.post('/delete-carrinho',
            { 
              id:dataid,
            },
            function (data,status)
            {
                location.href = "/carrinho" //app.get

            },"json")
          })
  })

////////FIM LIMPAR CARRINHO

////////////carrinho cupom
let code =[123,456] ;
function validate(coupon) { 
   // let code =[123,456] ;
  
  
 
   
   if (code[0]==coupon) 
    { 
    window.alert("Código de cupom aceito! Clique no botão comprar!"); 
    document.querySelector("#total3").innerHTML= (calculo -(calculo*0.10))
    } 
     else if (code[1]==coupon) 
    { 
    window.alert("Código de cupom aceito! Clique no botão comprar"); 
    document.querySelector("#total3").innerHTML= (calculo -(calculo*0.20))
    } 
   else 
    { 
    window.alert("Desculpe, o código do cupom que você digitou é inválido. Por favor verifique e tente novamente!"); 
    } 
   } 

</script>

<!-- =============== FOOTER ================== -->
<%- include('footer.ejs')%>
<!-- =============== Fim FOOTER ================== -->
</body>
</html>
